<nav class="navbar" id="navbar">
    <div class="navbar__inner">

        <!-- Logo / Brand -->
        <a href="/" class="navbar__brand" aria-label="Paper Valuation Home">
            <span class="navbar__brand-icon">ğŸ“</span>
            <span class="navbar__brand-name">PaperVal</span>
        </a>

        <!-- Desktop Navigation Links -->
        <ul class="navbar__links" role="list">
            <li>
                <a href="/"
                   class="navbar__link <%= typeof activePage !== 'undefined' && activePage === 'dashboard' ? 'navbar__link--active' : '' %>">
                    ğŸ  Dashboard
                </a>
            </li>
            <li>
                <a href="/answer-key-setup"
                   class="navbar__link <%= typeof activePage !== 'undefined' && activePage === 'answer-key' ? 'navbar__link--active' : '' %>">
                    ğŸ”‘ Answer Keys
                </a>
            </li>
            <li>
                <a href="/upload-individual"
                   class="navbar__link <%= typeof activePage !== 'undefined' && activePage === 'upload' ? 'navbar__link--active' : '' %>">
                    ğŸ“„ Evaluate
                </a>
            </li>
            <li>
                <a href="/history"
                   class="navbar__link <%= typeof activePage !== 'undefined' && activePage === 'history' ? 'navbar__link--active' : '' %>">
                    ğŸ“Š History
                </a>
            </li>
        </ul>

        <!-- Right side: user info + actions -->
        <div class="navbar__right">

            <!-- User badge -->
            <a href="/profile" class="navbar__user" aria-label="Go to profile">
                <div class="navbar__avatar" aria-hidden="true">
                    <%= (user.full_name || user.username).charAt(0).toUpperCase() %>
                </div>
                <span class="navbar__username"><%= user.full_name || user.username %></span>
            </a>

            <!-- Logout -->
            <form action="/logout" method="POST" style="display:inline;">
                <button type="submit" class="navbar__logout" aria-label="Logout">
                    ğŸšª Logout
                </button>
            </form>

            <!-- Hamburger (mobile only) -->
            <button
                class="navbar__burger"
                id="navBurger"
                aria-label="Toggle menu"
                aria-expanded="false"
                aria-controls="mobileMenu"
            >
                <span class="navbar__burger-bar"></span>
                <span class="navbar__burger-bar"></span>
                <span class="navbar__burger-bar"></span>
            </button>

        </div>
    </div>

    <!-- Mobile Dropdown Menu -->
    <div class="navbar__mobile" id="mobileMenu" aria-hidden="true">
        <a href="/"                  class="navbar__mobile-link">ğŸ  Dashboard</a>
        <a href="/answer-key-setup"  class="navbar__mobile-link">ğŸ”‘ Answer Keys</a>
        <a href="/upload-individual" class="navbar__mobile-link">ğŸ“„ Evaluate</a>
        <a href="/upload-series"     class="navbar__mobile-link">ğŸ“¦ Batch Evaluate</a>
        <a href="/history"           class="navbar__mobile-link">ğŸ“Š History</a>
        <a href="/profile"           class="navbar__mobile-link">ğŸ‘¤ Profile</a>
        <div class="navbar__mobile-divider"></div>
        <form action="/logout" method="POST">
            <button type="submit" class="navbar__mobile-logout">ğŸšª Logout</button>
        </form>
    </div>
</nav>

<script>
(function () {
    var burger = document.getElementById('navBurger');
    var menu   = document.getElementById('mobileMenu');

    burger.addEventListener('click', function () {
        var isOpen = menu.classList.toggle('is-open');
        burger.classList.toggle('is-open', isOpen);
        burger.setAttribute('aria-expanded', String(isOpen));
        menu.setAttribute('aria-hidden', String(!isOpen));
        document.body.style.overflow = isOpen ? 'hidden' : '';
    });

    document.addEventListener('click', function (e) {
        if (!e.target.closest('#navbar')) {
            menu.classList.remove('is-open');
            burger.classList.remove('is-open');
            burger.setAttribute('aria-expanded', 'false');
            menu.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }
    });

    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && menu.classList.contains('is-open')) {
            menu.classList.remove('is-open');
            burger.classList.remove('is-open');
            burger.setAttribute('aria-expanded', 'false');
            menu.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }
    });

    window.addEventListener('scroll', function () {
        document.getElementById('navbar').classList.toggle('navbar--scrolled', window.scrollY > 8);
    }, { passive: true });
})();
</script>
