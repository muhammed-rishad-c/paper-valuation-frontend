<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .exam-header { background: #2196F3; color: white; padding: 20px; border-radius: 5px; }
        .student-card { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .question-compare { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 10px 0; }
        .teacher-answer { background: #e3f2fd; padding: 10px; border-radius: 5px; }
        .student-answer { background: #fff3e0; padding: 10px; border-radius: 5px; }
        .export-btn { background: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="exam-header">
        <h1><%= examData.exam_metadata.exam_name %></h1>
        <p>Class: <%= examData.exam_metadata.class %> | Subject: <%= examData.exam_metadata.subject %></p>
        <p>Total Marks: <%= examData.exam_metadata.total_marks %></p>
        <p>Students Submitted: <%= examData.students.length %></p>
    </div>

    <button class="export-btn" onclick="exportValuationJSON()">
        üì• Export Complete Valuation Data (JSON)
    </button>

    <h2>Student Submissions</h2>

    <% examData.students.forEach((student, idx) => { %>
        <div class="student-card">
            <h3>Student <%= idx + 1 %>: <%= student.name %> (Roll: <%= student.roll_no %>)</h3>
            <p><strong>Status:</strong> <%= student.valuation_status %></p>

            <h4>Question-by-Question Comparison</h4>

            <% Object.keys(examData.teacher_answers).forEach(qNum => { %>
                <div style="margin: 20px 0; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                    <h5>Question <%= qNum %> 
                        (<%= examData.question_types[qNum] %> answer, 
                        <%= examData.question_marks[qNum] %> marks)
                    </h5>

                    <div class="question-compare">
                        <div class="teacher-answer">
                            <strong>‚úÖ Teacher's Answer:</strong>
                            <p><%= examData.teacher_answers[qNum] %></p>
                        </div>

                        <div class="student-answer">
                            <strong>üìù Student's Answer:</strong>
                            <p><%= student.answers[qNum] || '(No answer provided)' %></p>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    <% }) %>

    <script>
        function exportValuationJSON() {
            const valuationData = <%- JSON.stringify(examData) %>;
            
            const dataStr = JSON.stringify(valuationData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `valuation_${valuationData.exam_metadata.exam_id}_${Date.now()}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Valuation data exported! This JSON contains everything needed for AI grading.');
        }
    </script>
</body>
</html>